# nginx.conf

# This sets up the basic worker processes for Nginx.
events {
    worker_connections 1024;
}

http {
    # This section defines a "server" that listens for HTTP traffic.
    server {
        # Listen on port 8080, which is the port Cloud Run will send traffic to.
        listen 8080;
        server_name _; # A catch-all for any hostname.

        # This block handles all requests to your app.
        location / {
            # === THIS IS THE CRITICAL PART ===
            # This header tells the browser that only your website is allowed
            # to embed this app in an iframe.
            add_header Content-Security-Policy "frame-ancestors https://www.12taste.com https://12taste.com;";

            # These headers are essential for making Streamlit's WebSockets work
            # correctly through the Nginx proxy. Without them, the app will load
            # but the interactive elements will fail.
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            # This is where Nginx forwards the traffic to your Streamlit app,
            # which we will run on the internal port 8501.
            proxy_pass http://localhost:8501;
        }
    }
}
