# nginx.conf (Final Corrected Version)

events {
    worker_connections 1024;
}

http {
    # Set the root directory to the main Python installation folder.
    root /usr/local/lib/python3.12/site-packages/;

    server {
        listen 8080;
        server_name _;

        # This block handles requests for Streamlit's own frontend assets (JS, CSS, fonts).
        location ~ ^/static {
            # CORRECTED PATH: These files are in streamlit/web/server/static
            try_files /streamlit/web/server/$uri =404;
        }

        # This block handles requests for any custom component's assets.
        location ~ ^/component {
            # CORRECTED PATH: Component files are in streamlit/static/component-lib
            try_files /streamlit/static/component-lib/$uri =404;
        }
        
        # This block handles other specific static assets like the favicon and vendor files.
        location ~ ^/(favicon.ico|favicon.png|vendor) {
             # CORRECTED PATH: These are also in streamlit/web/server/static
             try_files /streamlit/web/server/static/$uri =404;
        }

        # This is the main block that handles the actual Streamlit application logic
        # by forwarding the request to the running Streamlit process.
        location / {
            add_header Content-Security-Policy "frame-ancestors https://www.12taste.com https://12taste.com;";

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass http://localhost:8501;
        }
    }
}
