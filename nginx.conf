# nginx.conf

events {
    worker_connections 1024;
}

http {
    server {
        listen 8080;
        server_name _;

        # === NEW LOCATION BLOCK FOR STREAMLIT COMPONENTS ===
        # This block specifically handles requests for custom component assets.
        location /component {
            # 'alias' tells Nginx where to find these files on the container's disk.
            # When you install a streamlit component, its frontend files are placed in
            # a standard location within the python site-packages directory.
            alias /usr/local/lib/python3.12/site-packages/streamlit/static/component-lib/;
            
            # This ensures that if a specific file isn't found, the request
            # doesn't accidentally fall through to the Streamlit backend.
            try_files $uri $uri/ =404;
        }

        # === YOUR EXISTING LOCATION BLOCK FOR THE MAIN APP ===
        # This block now handles all other requests (the main app).
        location / {
            add_header Content-Security-Policy "frame-ancestors https://www.12taste.com https://12taste.com;";

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass http://localhost:8501;
        }
    }
}
