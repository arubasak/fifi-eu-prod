events {
    worker_connections 1024;
}

http {
    # The global root directive is not strictly needed here as we will use 'alias'
    # within specific location blocks for Streamlit's static files.

    server {
        listen 8080;
        server_name _;

        # This block handles requests for Streamlit's own frontend assets (JS, CSS, fonts).
        # Example request: /static/media/SourceSansVF-Upright.ttf.BsWL4Kly.woff2
        location ~ ^/static/(.*)$ {
            # CORRECTED PATH: Files are in /usr/local/lib/python3.12/site-packages/streamlit/web/server/static/
            alias /usr/local/lib/python3.12/site-packages/streamlit/web/server/static/$1;
            try_files $uri =404;
        }

        # This block handles requests for any custom component's assets.
        # Example request: /component/my_component/index.js
        location ~ ^/component/(.*)$ {
            # CORRECTED PATH: Component files are in /usr/local/lib/python3.12/site-packages/streamlit/static/component-lib/
            alias /usr/local/lib/python3.12/site-packages/streamlit/static/component-lib/$1;
            try_files $uri =404;
        }
        
        # This block handles specific static assets like favicon.ico and favicon.png.
        # Example request: /favicon.ico
        location ~ ^/(favicon.ico|favicon.png)$ {
             # These are also in streamlit/web/server/static
             alias /usr/local/lib/python3.12/site-packages/streamlit/web/server/static/$1;
             try_files $uri =404;
        }

        # This block handles requests for /vendor files.
        # Example request: /vendor/some-library.js
        location ~ ^/vendor/(.*)$ {
             # Vendor files are typically in streamlit/web/server/static/vendor/
             alias /usr/local/lib/python3.12/site-packages/streamlit/web/server/static/vendor/$1;
             try_files $uri =404;
        }

        # This is the main block that handles the actual Streamlit application logic
        # by forwarding the request to the running Streamlit process.
        location / {
            add_header Content-Security-Policy "frame-ancestors https://www.12taste.com https://12taste.com;";

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass http://localhost:8501;
        }
    }
}
