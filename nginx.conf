# nginx.conf (Corrected and Final Version)

events {
    worker_connections 1024;
}

http {
    # Set the root directory to the main Python installation folder.
    root /usr/local/lib/python3.12/site-packages/;

    server {
        listen 8080;
        server_name _;

        # This block handles requests for Streamlit's own static assets (JS, CSS, etc.).
        # The path is relative to the 'root' defined above.
        location ~ ^/static {
            try_files /streamlit/$uri =404;
        }

        # This block handles requests for all custom components.
        # It looks for the component files directly in the site-packages directory.
        location ~ ^/component {
            try_files $uri =404;
        }
        
        # This block handles other specific static assets like the favicon.
        location ~ ^/(favicon.ico|favicon.png|vendor) {
             try_files /streamlit/static/$uri =404;
        }

        # This is the main block that handles the actual Streamlit application logic
        # by forwarding the request to the running Streamlit process.
        location / {
            add_header Content-Security-Policy "frame-ancestors https://www.12taste.com https://12taste.com;";

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;

            proxy_pass http://localhost:8501;
        }
    }
}
